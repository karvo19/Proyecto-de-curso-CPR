%% Modelo Cinematico Directo
% DATOS CINEMÁTICOS DEL BRAZO DEL ROBOT
% Dimensiones (m)
%   L0 = 1.00;    % Base
%   L1 = 0.40;  % Esalbón 1 
%   L2 = 0.70;  % Esalbón 2
%   L3 = 0.50;  % Esalbón 3
  
syms L0 L1 L2 L3 q1 q2 q3 real;

PI = sym('pi'); %para que el numero pi sea exacto

AU0 = MDH(0, L0, 0, 0);
A01 = MDH(q1, L1, 0, PI/2);
A12 = MDH(q2, 0, L2, 0);
A23 = MDH(q3, 0, L3, 0);

T = simplify(AU0*A01*A12*A23)

%% Simulacion del GTCL
clear
% close all

Tsim = 2;
XYZini = CinematicaDirecta([0 0 0]);
XYZfin = CinematicaDirecta([1 1 1]);
n = 5;
t_ini = 0.5;
duracion = 1;

accesible(XYZini, XYZfin);

sim('GTCL.mdl');

% graficas_pruebas;
graficas_gtcl;

%%
% Dimensiones (m)
L0 = 1.00;    % Base
L1 = 0.40;  % Esalbón 1 
L2 = 0.70;  % Esalbón 2
L3 = 0.50;  % Esalbón 3

L(1) = Link([0, L1+L0, 0, pi/2]);
L(1).offset = 0;
L(2) = Link([0, 0, L2, 0]);
L(2).offset = 0;
L(3) = Link([0, 0, L3, 0]);
L(3).offset = 0;
brazoC = SerialLink(L, 'name', 'brazoC');

puntos_q = [
                         0     -9.25185853854297e-17                         0
        0.0234966750664329        -0.275941180203625          1.09327818246034
        0.0573890013542422        -0.187989167815616          1.46592855631404
         0.110365911344146        0.0347376670806416          1.63554364322182
         0.204030784638009         0.339192567878672          1.61937232615786
         0.407211560836068         0.670703213487265          1.41708046113595
                         1                         1                         1];
puntos_xyz = zeros(length(puntos_q),3);
for i = 1:length(puntos_q)
    puntos_xyz(i,:) = CinematicaDirecta(puntos_q(i,:))';
end

xyz = zeros(length(qr),3);
for i = 1:length(qr)
    xyz(i,:) = CinematicaDirecta(qr(i,:))';
end

figure;plot3([XYZini(1) XYZfin(1)],[XYZini(2) XYZfin(2)],[XYZini(3) XYZfin(3)],'r','LineWidth',1.5); grid;hold on;
plot3(xyz(:,1),xyz(:,2),xyz(:,3),'b','LineWidth',1.5);
plot3(puntos_xyz(:,1),puntos_xyz(:,2),puntos_xyz(:,3),'k*');

for i = 1:20:length(qr)
    brazoC.plot(qr(i,:));
    % pause(0.1);
end

%% 
clear all;
XYZini = CinematicaDirecta([0 0 0]);
XYZfin = CinematicaDirecta([1 1 1]);

GTCL_R3GDL([XYZini', XYZfin', 98, 0.5, 1, 0])

%% Test de cinematica inversa
Q = [1 1 1];
XYZ = CinematicaDirecta(Q)'
XYZ = CinematicaDirecta(CinematicaInversa(CinematicaDirecta(Q)))'

q = [0    0.0235    0.0574    0.1104    0.2040    0.4072    1.0000
     0   -0.2759   -0.1880    1.2746    1.5793    0.6707    1.0000
     0    1.0933    1.4659   -1.5060   -1.5222    1.4171    1.0000];
 
 
XYZ = [1.2000   1.0153  0.8306  0.6460  0.4613  0.2766  0.0919
            0   0.0239  0.0477  0.0716  0.0954  0.1193  0.1432
       1.4000   1.5739  1.7479  1.9218  2.0958  2.2697  2.4437];

pendiente = zeros (3,6);
for i = 1:6
    pendiente(:,i) = XYZ(:,i+1) - XYZ(:,i);
end

%% trayetoria trambolica
q = [0    0.0012    0.0025    0.0037    0.0050    0.0063    0.0077    0.0090    0.0104    0.0118    0.0133    0.0148    0.0163    0.0178    0.0194  0.0210    0.0227    0.0243    0.0261    0.0278    0.0296    0.0315    0.0333    0.0353    0.0372    0.0393    0.0413    0.0435    0.0456    0.0479  0.0502    0.0525    0.0549    0.0574    0.0599    0.0625    0.0652    0.0680    0.0708    0.0737    0.0767    0.0798    0.0830    0.0863    0.0897  0.0932    0.0968    0.1005    0.1044    0.1083    0.1124    0.1167    0.1211    0.1256    0.1304    0.1353    0.1404    0.1456    0.1511    0.1568  0.1627    0.1689    0.1754    0.1821    0.1891    0.1964    0.2040    0.2120    0.2204    0.2292    0.2384    0.2481    0.2583    0.2690    0.2803  0.2922    0.3048    0.3181    0.3322    0.3471    0.3630    0.3799    0.3978    0.4169    0.4373    0.4592    0.4825    0.5075    0.5344    0.5632  0.5941    0.6274    0.6633    0.7018    0.7433    0.7879    0.8358    0.8870    0.9418    1.0000
    -0.0000   -0.1063   -0.1445   -0.1713   -0.1920   -0.2087   -0.2224   -0.2339   -0.2436   -0.2516   -0.2582   -0.2637   -0.2680   -0.2713   -0.2737   -0.2752   -0.2759   -0.2758   -0.2750   -0.2734   -0.2712   -0.2683   -0.2648   -0.2607   -0.2559   -0.2506   -0.2446   -0.2382   -0.2311   -0.2235   -0.2154   -0.2068   -0.1976   -0.1880   -0.1778   -0.1672   -0.1561   -0.1445   -0.1325   -0.1201   -0.1072    1.1466    1.1604    1.1744    1.1889 1.2037    1.2189    1.2344    1.2502    1.2664    1.2829    1.2997    1.3167    1.3341    1.3517    1.3696    1.3878    1.4061    1.4247    1.4435  1.4624    1.4816    1.5009    1.5203    1.5399    1.5595    1.5793    1.5992    1.6191    1.6391    1.6592    1.6792    0.4588    0.4789    0.4991  0.5192    0.5394    0.5596    0.5798    0.6000    0.6202    0.6404    0.6606    0.6808    0.7010    0.7211    0.7412    0.7614    0.7814    0.8015  0.8215    0.8415    0.8615    0.8814    0.9013    0.9211    0.9409    0.9606    0.9803    1.0000
     0    0.2767    0.3908    0.4779    0.5511    0.6152    0.6729    0.7256    0.7744    0.8200    0.8628    0.9032    0.9415    0.9780    1.0127  1.0460    1.0778    1.1084    1.1377    1.1659    1.1931    1.2192    1.2444    1.2686    1.2919    1.3144    1.3361    1.3569    1.3770    1.3962  1.4148    1.4325    1.4496    1.4659    1.4815    1.4965    1.5107    1.5242    1.5370    1.5492    1.5606   -1.5702   -1.5601   -1.5507   -1.5419  -1.5339   -1.5265   -1.5198   -1.5138   -1.5085   -1.5038   -1.4998   -1.4965   -1.4939   -1.4920   -1.4908   -1.4902   -1.4903   -1.4912   -1.4927  -1.4948   -1.4977   -1.5012   -1.5055   -1.5104   -1.5160   -1.5222   -1.5292   -1.5368   -1.5451   -1.5541   -1.5638    1.5675    1.5565    1.5447  1.5323    1.5193    1.5055    1.4910    1.4758    1.4599    1.4433    1.4260    1.4080    1.3892    1.3696    1.3492    1.3281    1.3062    1.2834  1.2597    1.2351    1.2096    1.1831    1.1556    1.1270    1.0972    1.0662    1.0338    1.0000];

%% Seguir la trayectoria circular (2)
q = [0    0.0012    0.0025    0.0037    0.0050    0.0063    0.0077    0.0090    0.0104    0.0118    0.0133    0.0148    0.0163    0.0178    0.0194  0.0210    0.0227    0.0243    0.0261    0.0278    0.0296    0.0315    0.0333    0.0353    0.0372    0.0393    0.0413    0.0435    0.0456    0.0479  0.0502    0.0525    0.0549    0.0574    0.0599    0.0625    0.0652    0.0680    0.0708    0.0737    0.0767    0.0798    0.0830    0.0863    0.0897  0.0932    0.0968    0.1005    0.1044    0.1083    0.1124    0.1167    0.1211    0.1256    0.1304    0.1353    0.1404    0.1456    0.1511    0.1568  0.1627    0.1689    0.1754    0.1821    0.1891    0.1964    0.2040    0.2120    0.2204    0.2292    0.2384    0.2481    0.2583    0.2690    0.2803  0.2922    0.3048    0.3181    0.3322    0.3471    0.3630    0.3799    0.3978    0.4169    0.4373    0.4592    0.4825    0.5075    0.5344    0.5632  0.5941    0.6274    0.6633    0.7018    0.7433    0.7879    0.8358    0.8870    0.9418    1.0000
    -0.0000   -0.1063   -0.1445   -0.1713   -0.1920   -0.2087   -0.2224   -0.2339   -0.2436   -0.2516   -0.2582   -0.2637   -0.2680   -0.2713   -0.2737   -0.2752   -0.2759   -0.2758   -0.2750   -0.2734   -0.2712   -0.2683   -0.2648   -0.2607   -0.2559   -0.2506   -0.2446   -0.2382   -0.2311   -0.2235   -0.2154   -0.2068   -0.1976   -0.1880   -0.1778   -0.1672   -0.1561   -0.1445   -0.1325   -0.1201   -0.1072    1.1466    1.1604    1.1744    1.1889 1.2037    1.2189    1.2344    1.2502    1.2664    1.2829    1.2997    1.3167    1.3341    1.3517    1.3696    1.3878    1.4061    1.4247    1.4435  1.4624    1.4816    1.5009    1.5203    1.5399    1.5595    1.5793    1.5992    1.6191    1.6391    1.6592    1.6792    0.4588    0.4789    0.4991  0.5192    0.5394    0.5596    0.5798    0.6000    0.6202    0.6404    0.6606    0.6808    0.7010    0.7211    0.7412    0.7614    0.7814    0.8015  0.8215    0.8415    0.8615    0.8814    0.9013    0.9211    0.9409    0.9606    0.9803    1.0000
     0    0.2767    0.3908    0.4779    0.5511    0.6152    0.6729    0.7256    0.7744    0.8200    0.8628    0.9032    0.9415    0.9780    1.0127  1.0460    1.0778    1.1084    1.1377    1.1659    1.1931    1.2192    1.2444    1.2686    1.2919    1.3144    1.3361    1.3569    1.3770    1.3962  1.4148    1.4325    1.4496    1.4659    1.4815    1.4965    1.5107    1.5242    1.5370    1.5492    1.5606   -1.5702   -1.5601   -1.5507   -1.5419  -1.5339   -1.5265   -1.5198   -1.5138   -1.5085   -1.5038   -1.4998   -1.4965   -1.4939   -1.4920   -1.4908   -1.4902   -1.4903   -1.4912   -1.4927  -1.4948   -1.4977   -1.5012   -1.5055   -1.5104   -1.5160   -1.5222   -1.5292   -1.5368   -1.5451   -1.5541   -1.5638    1.5675    1.5565    1.5447  1.5323    1.5193    1.5055    1.4910    1.4758    1.4599    1.4433    1.4260    1.4080    1.3892    1.3696    1.3492    1.3281    1.3062    1.2834  1.2597    1.2351    1.2096    1.1831    1.1556    1.1270    1.0972    1.0662    1.0338    1.0000];
 
% Dimensiones (m)
L0 = 1.00;    % Base
L1 = 0.40;  % Esalbón 1 
L2 = 0.70;  % Esalbón 2
L3 = 0.50;  % Esalbón 3

L(1) = Link([0, L1+L0, 0, pi/2]);
L(1).offset = 0;
L(2) = Link([0, 0, L2, 0]);
L(2).offset = 0;
L(3) = Link([0, 0, L3, 0]);
L(3).offset = 0;
brazoC = SerialLink(L, 'name', 'brazoC');

XYZini = CinematicaDirecta([0 0 0]);
XYZfin = CinematicaDirecta([1 1 1]);

figure;plot3([XYZini(1) XYZfin(1)],[XYZini(2) XYZfin(2)],[XYZini(3) XYZfin(3)],'r','LineWidth',1); grid;hold on;

for i = 1:100
    brazoC.plot(q(:,i)');
    %pause(0.1);
end

%%
I = CinematicaInversa(CinematicaDirecta([1 2 3]),1,1)
% figure();
% brazoC.plot(I')
I = CinematicaInversa(CinematicaDirecta([1 2 3]),1,-1)
% figure();
% brazoC.plot(I')
I = CinematicaInversa(CinematicaDirecta([1 2 3]),-1,1)
% figure();
% brazoC.plot(I')
I = CinematicaInversa(CinematicaDirecta([1 2 3]),-1,-1)
% figure();
% brazoC.plot(I')

%% 
xyz = [0.7 0.4 2];
I = CinematicaDirecta(CinematicaInversa(xyz,1))
figure(1);
brazoC.plot(CinematicaInversa(xyz,1)')
I = CinematicaDirecta(CinematicaInversa(xyz,-1))
figure(2);
brazoC.plot(CinematicaInversa(xyz,-1)')
